<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CommunityHub | Gestão de Atividades Extensionistas</title>
    <meta name="description" content="Plataforma para gestão de centros comunitários, atividades extensionistas, agenda, mídia e relatórios - Alinhado com PDCA">
    <meta name="keywords" content="gestão comunitária, atividades extensionistas, PDCA, centro comunitário, projetos sociais">
    <meta name="author" content="Dione Castro Alves - InNovaIdeia">
    <meta property="og:title" content="CommunityHub - Gestão Inteligente">
    <meta property="og:description" content="Sistema completo para gerenciamento de centros comunitários e relatórios acadêmicos.">
    
    <!-- Bootstrap 5 + Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <style>
        /* ===== ESTILOS GLOBAIS ===== */
        :root {
            --primary: #0d6efd;
            --secondary: #6c757d;
            --success: #198754;
            --danger: #dc3545;
            --warning: #ffc107;
            --info: #0dcaf0;
        }
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', system-ui, sans-serif;
            scroll-behavior: smooth;
        }
        .navbar-brand { font-weight: 700; font-size: 1.5rem; letter-spacing: -0.5px; }
        .hero {
            background: linear-gradient(135deg, var(--primary) 0%, #0a58ca 100%);
            color: white;
            padding: 100px 0 80px;
            position: relative;
            overflow: hidden;
        }
        .hero::before {
            content: '';
            position: absolute;
            inset: 0;
            background: url('data:image/svg+xml,<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="50" r="2" fill="rgba(255,255,255,0.1)"/></svg>');
            opacity: 0.5;
        }
        .hero-content { position: relative; z-index: 1; }
        .section-title {
            font-weight: 700;
            letter-spacing: -0.5px;
            position: relative;
            display: inline-block;
            margin-bottom: 2rem;
        }
        .section-title::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 0;
            width: 60px;
            height: 4px;
            background: var(--primary);
            border-radius: 2px;
        }
        .stat-card {
            border-left: 4px solid;
            transition: all 0.3s ease;
            height: 100%;
        }
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .stat-card.primary { border-color: var(--primary); }
        .stat-card.success { border-color: var(--success); }
        .stat-card.warning { border-color: var(--warning); }
        .stat-card.info { border-color: var(--info); }
        .stat-value { font-size: 2.5rem; font-weight: 700; line-height: 1; }
        .stat-label { color: #6c757d; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.5px; margin-top: 0.5rem; }
        .activity-card {
            transition: all 0.3s ease;
            border: none;
            border-radius: 12px;
            overflow: hidden;
            height: 100%;
        }
        .activity-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }
        .activity-card img { height: 200px; object-fit: cover; }
        .badge-category {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.75rem;
        }
        .badge-esporte { background-color: #e3f2fd; color: #1976d2; }
        .badge-cultura { background-color: #f3e5f5; color: #7b1fa2; }
        .badge-educacao { background-color: #e8f5e9; color: #388e3c; }
        .badge-saude { background-color: #fff3e0; color: #f57c00; }
        .calendar-week {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        .calendar-day {
            background: white;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }
        .calendar-day:hover { transform: translateY(-3px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .calendar-day.has-event { border-left: 4px solid var(--primary); }
        .day-name { font-weight: 600; font-size: 0.8rem; text-transform: uppercase; color: #6c757d; }
        .day-number { font-size: 1.5rem; font-weight: 700; margin: 5px 0; }
        .event-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--primary); display: inline-block; margin: 3px; }
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }
        .gallery-item {
            position: relative;
            overflow: hidden;
            border-radius: 12px;
            cursor: pointer;
            aspect-ratio: 1;
        }
        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        .gallery-item:hover img { transform: scale(1.1); }
        .gallery-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
            color: white;
            padding: 15px;
            transform: translateY(100%);
            transition: transform 0.3s ease;
        }
        .gallery-item:hover .gallery-overlay { transform: translateY(0); }
        .data-table {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .data-table th {
            background: #f8f9fa;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.85rem;
            padding: 15px;
        }
        .data-table td { padding: 15px; vertical-align: middle; }
        .action-buttons .btn { padding: 5px 10px; margin: 0 2px; }
        footer {
            background: linear-gradient(135deg, #0a58ca 0%, var(--primary) 100%);
            color: white;
            padding: 40px 0 20px;
        }
        footer a { color: rgba(255,255,255,0.8); text-decoration: none; transition: color 0.3s; }
        footer a:hover { color: white; }
        @media (max-width: 768px) {
            .calendar-week { grid-template-columns: 1fr; }
            .hero { padding: 60px 0 40px; }
        }
        /* Admin panel tabs */
        .admin-tab-content { padding: 20px 0; }
        .admin-table img { width: 50px; height: 50px; object-fit: cover; border-radius: 4px; }
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Mural de avisos */
        .notice-card {
            border: none;
            border-radius: 12px;
            transition: transform 0.2s;
            height: 100%;
        }
        .notice-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .notice-date {
            font-size: 0.8rem;
            color: #6c757d;
            display: flex;
            align-items: center;
            gap: 5px;
        }
    </style>
</head>
<body>
    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm sticky-top">
        <div class="container">
            <a class="navbar-brand" href="#"><i class="bi bi-buildings-fill me-2"></i>CommunityHub</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#menu">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="menu">
                <ul class="navbar-nav ms-auto align-items-center">
                    <li class="nav-item"><a class="nav-link" href="#dashboard">Dashboard</a></li>
                    <li class="nav-item"><a class="nav-link" href="#mural">Mural</a></li>
                    <li class="nav-item"><a class="nav-link" href="#centros">Centros</a></li>
                    <li class="nav-item"><a class="nav-link" href="#atividades">Atividades</a></li>
                    <li class="nav-item"><a class="nav-link" href="#agenda">Agenda</a></li>
                    <li class="nav-item"><a class="nav-link" href="#galeria">Galeria</a></li>
                    <li class="nav-item"><a class="nav-link" href="#relatorios">Relatórios</a></li>
                    <li class="nav-item ms-3">
                        <button class="btn btn-admin btn-sm" data-bs-toggle="modal" data-bs-target="#modalAdmin">
                            <i class="bi bi-gear-fill me-1"></i>Admin
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- HERO -->
    <section class="hero">
        <div class="container hero-content">
            <div class="row align-items-center">
                <div class="col-lg-7">
                    <h1 class="display-4 fw-bold mb-3">Sistema de Gestão de Atividades Extensionistas</h1>
                    <p class="lead mb-4">Plataforma completa para gerenciamento de centros comunitários, atividades sociais, agenda integrada e geração de relatórios acadêmicos alinhados com o ciclo PDCA.</p>
                    <div class="d-flex gap-3 flex-wrap">
                        <a href="#dashboard" class="btn btn-light btn-lg shadow-sm"><i class="bi bi-speedometer2 me-2"></i>Ver Dashboard</a>
                        <a href="#relatorios" class="btn btn-outline-light btn-lg"><i class="bi bi-file-earmark-text me-2"></i>Gerar Relatório</a>
                    </div>
                </div>
                <div class="col-lg-5 text-center mt-4 mt-lg-0">
                    <i class="bi bi-diagram-3-fill" style="font-size: 200px; opacity: 0.2;"></i>
                </div>
            </div>
        </div>
    </section>

    <!-- DASHBOARD -->
    <section id="dashboard" class="py-5">
        <div class="container">
            <h2 class="section-title">Dashboard de Indicadores</h2>
            <div class="row g-4 mb-5" id="statsContainer"></div>
            <div class="row g-4">
                <div class="col-lg-8">
                    <div class="card shadow-sm">
                        <div class="card-header bg-white"><h5 class="mb-0"><i class="bi bi-bar-chart-fill me-2"></i>Atividades por Categoria</h5></div>
                        <div class="card-body"><canvas id="categoriesChart" height="80"></canvas></div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="card shadow-sm">
                        <div class="card-header bg-white"><h5 class="mb-0"><i class="bi bi-pie-chart-fill me-2"></i>Distribuição</h5></div>
                        <div class="card-body"><canvas id="distributionChart"></canvas></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- MURAL DE AVISOS (NOVO COMPONENTE) -->
    <section id="mural" class="py-5 bg-light">
        <div class="container">
            <h2 class="section-title">Mural de Avisos</h2>
            <div class="row g-4" id="avisosContainer"></div>
        </div>
    </section>

    <!-- CENTROS -->
    <section id="centros" class="py-5">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="section-title mb-0">Centros Comunitários</h2>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalCentro"><i class="bi bi-plus-circle me-2"></i>Novo Centro</button>
            </div>
            <div class="card data-table shadow-sm">
                <table class="table table-hover mb-0">
                    <thead><tr><th>ID</th><th>Nome</th><th>Cidade/Estado</th><th>Telefone</th><th>E-mail</th><th>Atividades</th><th class="text-center">Ações</th></tr></thead>
                    <tbody id="centrosTable"></tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- ATIVIDADES -->
    <section id="atividades" class="py-5 bg-light">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="section-title mb-0">Atividades Extensionistas</h2>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalAtividade"><i class="bi bi-plus-circle me-2"></i>Nova Atividade</button>
            </div>
            <!-- Filtros -->
            <div class="card shadow-sm mb-4">
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-4"><select class="form-select" id="filtroCategoria" aria-label="Filtrar por categoria"><option value="">Todas as Categorias</option><option>Esporte</option><option>Cultura</option><option>Educação</option><option>Saúde</option></select></div>
                        <div class="col-md-4"><select class="form-select" id="filtroCentro" aria-label="Filtrar por centro"><option value="">Todos os Centros</option></select></div>
                        <div class="col-md-4"><select class="form-select" id="filtroStatus" aria-label="Filtrar por status"><option value="">Status: Todas</option><option>Ativa</option><option>Planejamento</option><option>Concluída</option></select></div>
                    </div>
                </div>
            </div>
            <div class="row g-4" id="atividadesGrid"></div>
        </div>
    </section>

    <!-- AGENDA -->
    <section id="agenda" class="py-5">
        <div class="container">
            <h2 class="section-title">Agenda Semanal</h2>
            <div class="calendar-week mb-4" id="calendarioSemanas"></div>
            <div class="card data-table shadow-sm">
                <div class="card-header bg-white"><h5 class="mb-0"><i class="bi bi-calendar3 me-2"></i>Programação Detalhada</h5></div>
                <table class="table table-hover mb-0">
                    <thead><tr><th>Dia</th><th>Horário</th><th>Atividade</th><th>Centro</th><th>Local</th><th>Responsável</th><th class="text-center">Status</th></tr></thead>
                    <tbody id="agendaTable"></tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- GALERIA -->
    <section id="galeria" class="py-5 bg-light">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="section-title mb-0">Galeria de Mídia</h2>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalMidia"><i class="bi bi-cloud-upload me-2"></i>Upload de Mídia</button>
            </div>
            <div class="gallery-grid" id="galeriaGrid"></div>
        </div>
    </section>

    <!-- RELATÓRIOS -->
    <section id="relatorios" class="py-5">
        <div class="container">
            <h2 class="section-title">Geração de Relatórios</h2>
            <div class="row g-4 mb-5">
                <div class="col-lg-8">
                    <div class="card shadow-sm">
                        <div class="card-header bg-white"><h5 class="mb-0"><i class="bi bi-arrow-repeat me-2"></i>Ciclo PDCA</h5></div>
                        <div class="card-body"><!-- Timeline resumida, sem alterações --></div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="card shadow-sm">
                        <div class="card-header bg-primary text-white"><h5 class="mb-0"><i class="bi bi-file-earmark-pdf me-2"></i>Gerar Relatório</h5></div>
                        <div class="card-body">
                            <div class="mb-3"><label for="selectAtividade" class="form-label">Atividade</label><select class="form-select" id="selectAtividade"></select></div>
                            <div class="mb-3"><label for="selectPeriodo" class="form-label">Período</label><select class="form-select" id="selectPeriodo"><option>Último Semestre</option><option>Último Trimestre</option><option>Último Mês</option></select></div>
                            <div class="mb-3"><label for="selectTipo" class="form-label">Tipo</label><select class="form-select" id="selectTipo"><option>Relatório Completo PDCA</option><option>Relatório de Atividades</option></select></div>
                            <button class="btn btn-primary w-100 mb-2" data-bs-toggle="modal" data-bs-target="#modalRelatorio"><i class="bi bi-file-earmark-pdf me-2"></i>Gerar PDF</button>
                        </div>
                    </div>
                    <div class="card shadow-sm mt-4"><!-- Autoavaliação estática --></div>
                </div>
            </div>
        </div>
    </section>

    <!-- FOOTER -->
    <footer class="mt-5">
        <div class="container">
            <div class="row g-4">
                <div class="col-md-4"><h5 class="fw-bold mb-3"><i class="bi bi-buildings-fill me-2"></i>CommunityHub</h5><p class="text-white-50">Sistema de gestão de atividades extensionistas para centros comunitários e ONGs. Tecnologia a serviço do impacto social.</p></div>
                <div class="col-md-4"><h6 class="fw-bold mb-3">Links Úteis</h6><ul class="list-unstyled"><li class="mb-2"><a href="#dashboard">Dashboard</a></li><li class="mb-2"><a href="#mural">Mural</a></li><li class="mb-2"><a href="#centros">Centros Parceiros</a></li><li class="mb-2"><a href="#atividades">Atividades</a></li></ul></div>
                <div class="col-md-4"><h6 class="fw-bold mb-3">Desenvolvido por</h6><p class="text-white-50 mb-2"><strong>Dione Castro Alves</strong><br>InNovaIdeia - Consultoria e Inovação</p><div class="d-flex gap-3"><a href="#" class="text-white"><i class="bi bi-linkedin" style="font-size: 1.5rem;"></i></a><a href="#" class="text-white"><i class="bi bi-github" style="font-size: 1.5rem;"></i></a><a href="#" class="text-white"><i class="bi bi-envelope" style="font-size: 1.5rem;"></i></a></div></div>
            </div>
            <hr class="my-4 border-white opacity-25">
            <div class="text-center text-white-50 pb-3"><p class="mb-0">© 2026 CommunityHub | Atividade Extensionista - 3° Semestre ADS | <a href="#" class="text-white">Política de Privacidade</a></p></div>
        </div>
    </footer>

    <!-- ========== MODAIS ========== -->
    <!-- Modal Admin (com nova aba Mural) -->
    <div class="modal fade" id="modalAdmin" tabindex="-1" aria-labelledby="modalAdminLabel" aria-hidden="true" data-bs-backdrop="static">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="modalAdminLabel"><i class="bi bi-gear-fill me-2"></i>Painel Administrativo</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                    <!-- Abas -->
                    <ul class="nav nav-tabs" id="adminTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="centros-tab" data-bs-toggle="tab" data-bs-target="#centros-admin" type="button" role="tab">Centros</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="atividades-tab" data-bs-toggle="tab" data-bs-target="#atividades-admin" type="button" role="tab">Atividades</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="agenda-tab" data-bs-toggle="tab" data-bs-target="#agenda-admin" type="button" role="tab">Agenda</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="galeria-tab" data-bs-toggle="tab" data-bs-target="#galeria-admin" type="button" role="tab">Galeria</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="mural-tab" data-bs-toggle="tab" data-bs-target="#mural-admin" type="button" role="tab">Mural</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="importExport-tab" data-bs-toggle="tab" data-bs-target="#importExport-admin" type="button" role="tab">Importar/Exportar</button>
                        </li>
                    </ul>
                    <div class="tab-content admin-tab-content" id="adminTabContent">
                        <!-- Centros -->
                        <div class="tab-pane fade show active" id="centros-admin" role="tabpanel">
                            <div class="d-flex justify-content-between mb-3">
                                <h5>Gerenciar Centros</h5>
                                <button class="btn btn-sm btn-primary" onclick="abrirModalCentroAdmin()"><i class="bi bi-plus"></i> Novo Centro</button>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead><tr><th>ID</th><th>Nome</th><th>Cidade</th><th>Telefone</th><th>Email</th><th>Ações</th></tr></thead>
                                    <tbody id="adminCentrosTable"></tbody>
                                </table>
                            </div>
                        </div>
                        <!-- Atividades -->
                        <div class="tab-pane fade" id="atividades-admin" role="tabpanel">
                            <div class="d-flex justify-content-between mb-3">
                                <h5>Gerenciar Atividades</h5>
                                <button class="btn btn-sm btn-primary" onclick="abrirModalAtividadeAdmin()"><i class="bi bi-plus"></i> Nova Atividade</button>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead><tr><th>ID</th><th>Nome</th><th>Categoria</th><th>Centro</th><th>Responsável</th><th>Status</th><th>Ações</th></tr></thead>
                                    <tbody id="adminAtividadesTable"></tbody>
                                </table>
                            </div>
                        </div>
                        <!-- Agenda -->
                        <div class="tab-pane fade" id="agenda-admin" role="tabpanel">
                            <div class="d-flex justify-content-between mb-3">
                                <h5>Gerenciar Agenda</h5>
                                <button class="btn btn-sm btn-primary" onclick="abrirModalAgendaAdmin()"><i class="bi bi-plus"></i> Novo Evento</button>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead><tr><th>ID</th><th>Dia</th><th>Horário</th><th>Atividade</th><th>Local</th><th>Responsável</th><th>Ações</th></tr></thead>
                                    <tbody id="adminAgendaTable"></tbody>
                                </table>
                            </div>
                        </div>
                        <!-- Galeria -->
                        <div class="tab-pane fade" id="galeria-admin" role="tabpanel">
                            <div class="d-flex justify-content-between mb-3">
                                <h5>Gerenciar Mídia</h5>
                                <button class="btn btn-sm btn-primary" onclick="abrirModalGaleriaAdmin()"><i class="bi bi-plus"></i> Adicionar Imagem</button>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead><tr><th>ID</th><th>Imagem</th><th>Atividade</th><th>Legenda</th><th>Ações</th></tr></thead>
                                    <tbody id="adminGaleriaTable"></tbody>
                                </table>
                            </div>
                        </div>
                        <!-- Mural de Avisos (NOVA ABA) -->
                        <div class="tab-pane fade" id="mural-admin" role="tabpanel">
                            <div class="d-flex justify-content-between mb-3">
                                <h5>Gerenciar Avisos</h5>
                                <button class="btn btn-sm btn-primary" onclick="abrirModalAvisoAdmin()"><i class="bi bi-plus"></i> Novo Aviso</button>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead><tr><th>ID</th><th>Título</th><th>Mensagem</th><th>Data</th><th>Autor</th><th>Ações</th></tr></thead>
                                    <tbody id="adminAvisosTable"></tbody>
                                </table>
                            </div>
                        </div>
                        <!-- Importar/Exportar -->
                        <div class="tab-pane fade" id="importExport-admin" role="tabpanel">
                            <h5>Exportar Dados</h5>
                            <button class="btn btn-success mb-3" onclick="exportarJSON()"><i class="bi bi-download"></i> Exportar para JSON</button>
                            <h5>Importar Dados</h5>
                            <div class="mb-3">
                                <label for="importFile" class="form-label">Selecione um arquivo JSON</label>
                                <input class="form-control" type="file" id="importFile" accept=".json">
                            </div>
                            <button class="btn btn-warning" onclick="importarJSON()"><i class="bi bi-upload"></i> Importar e Substituir Dados</button>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Centro (CRUD) -->
    <div class="modal fade" id="modalCentro" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title" id="modalCentroTitle">Novo Centro</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button></div>
                <div class="modal-body">
                    <form id="formCentro">
                        <input type="hidden" id="centroId">
                        <div class="mb-3"><label for="centroNome" class="form-label">Nome</label><input type="text" class="form-control" id="centroNome" required></div>
                        <div class="mb-3"><label for="centroCidade" class="form-label">Cidade/UF</label><input type="text" class="form-control" id="centroCidade" placeholder="Ex: São Paulo/SP" required></div>
                        <div class="mb-3"><label for="centroTelefone" class="form-label">Telefone</label><input type="tel" class="form-control" id="centroTelefone" required></div>
                        <div class="mb-3"><label for="centroEmail" class="form-label">E-mail</label><input type="email" class="form-control" id="centroEmail" required></div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="salvarCentro()">Salvar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Atividade (CRUD) -->
    <div class="modal fade" id="modalAtividade" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title" id="modalAtividadeTitle">Nova Atividade</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <form id="formAtividade">
                        <input type="hidden" id="atividadeId">
                        <div class="mb-3"><label for="atvNome" class="form-label">Nome</label><input type="text" class="form-control" id="atvNome" required></div>
                        <div class="mb-3"><label for="atvCategoria" class="form-label">Categoria</label><select class="form-select" id="atvCategoria"><option>Esporte</option><option>Cultura</option><option>Educação</option><option>Saúde</option></select></div>
                        <div class="mb-3"><label for="atvCentro" class="form-label">Centro</label><select class="form-select" id="atvCentro"></select></div>
                        <div class="mb-3"><label for="atvResponsavel" class="form-label">Responsável</label><input type="text" class="form-control" id="atvResponsavel" required></div>
                        <div class="mb-3"><label for="atvStatus" class="form-label">Status</label><select class="form-select" id="atvStatus"><option>Ativa</option><option>Planejamento</option><option>Concluída</option></select></div>
                        <div class="mb-3"><label for="atvDescricao" class="form-label">Descrição</label><textarea class="form-control" id="atvDescricao" rows="2"></textarea></div>
                        <div class="mb-3"><label for="atvImagem" class="form-label">URL da Imagem</label><input type="url" class="form-control" id="atvImagem" placeholder="https://..."></div>
                        <div class="mb-3"><label for="atvLocal" class="form-label">Local</label><input type="text" class="form-control" id="atvLocal"></div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="salvarAtividade()">Salvar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Agenda (CRUD) -->
    <div class="modal fade" id="modalAgenda" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title" id="modalAgendaTitle">Novo Evento</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <form id="formAgenda">
                        <input type="hidden" id="agendaId">
                        <div class="mb-3"><label for="agDia" class="form-label">Dia</label><select class="form-select" id="agDia"><option>Segunda</option><option>Terça</option><option>Quarta</option><option>Quinta</option><option>Sexta</option><option>Sábado</option><option>Domingo</option></select></div>
                        <div class="mb-3"><label for="agHorario" class="form-label">Horário</label><input type="text" class="form-control" id="agHorario" placeholder="Ex: 18:00 - 20:00" required></div>
                        <div class="mb-3"><label for="agAtividade" class="form-label">Atividade</label><select class="form-select" id="agAtividade"></select></div>
                        <div class="mb-3"><label for="agLocal" class="form-label">Local</label><input type="text" class="form-control" id="agLocal" required></div>
                        <div class="mb-3"><label for="agResponsavel" class="form-label">Responsável</label><input type="text" class="form-control" id="agResponsavel" required></div>
                        <div class="mb-3"><label for="agStatus" class="form-label">Status</label><select class="form-select" id="agStatus"><option>Confirmado</option><option>Cancelado</option><option>Remarcado</option></select></div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="salvarAgenda()">Salvar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Galeria (CRUD) -->
    <div class="modal fade" id="modalGaleria" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title" id="modalGaleriaTitle">Adicionar Imagem</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <form id="formGaleria">
                        <input type="hidden" id="galeriaId">
                        <div class="mb-3"><label for="galAtividade" class="form-label">Atividade</label><select class="form-select" id="galAtividade"></select></div>
                        <div class="mb-3"><label for="galImagem" class="form-label">URL da Imagem</label><input type="url" class="form-control" id="galImagem" required></div>
                        <div class="mb-3"><label for="galLegenda" class="form-label">Legenda</label><input type="text" class="form-control" id="galLegenda" required></div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="salvarGaleria()">Salvar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Aviso (NOVO) -->
    <div class="modal fade" id="modalAviso" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title" id="modalAvisoTitle">Novo Aviso</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <form id="formAviso">
                        <input type="hidden" id="avisoId">
                        <div class="mb-3"><label for="avisoTitulo" class="form-label">Título</label><input type="text" class="form-control" id="avisoTitulo" required></div>
                        <div class="mb-3"><label for="avisoMensagem" class="form-label">Mensagem</label><textarea class="form-control" id="avisoMensagem" rows="3" required></textarea></div>
                        <div class="mb-3"><label for="avisoData" class="form-label">Data</label><input type="date" class="form-control" id="avisoData" required></div>
                        <div class="mb-3"><label for="avisoAutor" class="form-label">Autor</label><input type="text" class="form-control" id="avisoAutor" required></div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="salvarAviso()">Salvar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Relatório (simples) -->
    <div class="modal fade" id="modalRelatorio" tabindex="-1">
        <div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Relatório Gerado</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><p>✅ Relatório simulado com sucesso! (Funcionalidade demonstrativa)</p></div><div class="modal-footer"><button type="button" class="btn btn-primary" data-bs-dismiss="modal">OK</button></div></div></div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // ==================== GERENCIAMENTO DE DADOS COM LOCALSTORAGE ====================
        let centros = [];
        let atividades = [];
        let agenda = [];
        let galeria = [];
        let avisos = [];  // NOVO: array de avisos

        // Chaves do localStorage
        const STORAGE_KEYS = {
            CENTROS: 'communityhub_centros',
            ATIVIDADES: 'communityhub_atividades',
            AGENDA: 'communityhub_agenda',
            GALERIA: 'communityhub_galeria',
            AVISOS: 'communityhub_avisos'   // NOVA chave
        };

        // Carregar dados do localStorage ou inicializar com mock
        function carregarDados() {
            centros = JSON.parse(localStorage.getItem(STORAGE_KEYS.CENTROS)) || [
                { id: 1, nome: 'Centro Social Vila Nova', cidade: 'São Paulo/SP', telefone: '(11) 3456-7890', email: 'contato@vilanova.org', atividades: 8 },
                { id: 2, nome: 'ONG Crescer Juntos', cidade: 'Campinas/SP', telefone: '(19) 2345-6789', email: 'info@crescerjuntos.org', atividades: 5 },
                { id: 3, nome: 'Associação Cultural Horizonte', cidade: 'Santos/SP', telefone: '(13) 3210-9876', email: 'contato@horizonte.com', atividades: 12 }
            ];
            atividades = JSON.parse(localStorage.getItem(STORAGE_KEYS.ATIVIDADES)) || [
                { id: 1, nome: 'Karatê Comunitário', categoria: 'Esporte', status: 'Ativa', centroId: 1, responsavel: 'Prof. João Silva', descricao: 'Desenvolvimento físico e inclusão social', imagem: 'https://images.unsplash.com/photo-1555597673-b21d5c935865', local: 'Sala Esportiva' },
                { id: 2, nome: 'Ballet Social', categoria: 'Cultura', status: 'Ativa', centroId: 2, responsavel: 'Profa. Maria Santos', descricao: 'Expressão artística', imagem: 'https://images.unsplash.com/photo-1518837695005-2083093ee35b', local: 'Sala Cultural' },
                { id: 3, nome: 'Inclusão Digital', categoria: 'Educação', status: 'Ativa', centroId: 3, responsavel: 'Prof. Carlos Oliveira', descricao: 'Capacitação em informática', imagem: 'https://images.unsplash.com/photo-1519389950473-47ba0277781c', local: 'Lab. Informática' },
                { id: 4, nome: 'Yoga para Idosos', categoria: 'Saúde', status: 'Planejamento', centroId: 1, responsavel: 'Profa. Ana Paula', descricao: 'Bem-estar', imagem: 'https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b', local: 'Sala Multiuso' },
                { id: 5, nome: 'Escolinha de Futebol', categoria: 'Esporte', status: 'Ativa', centroId: 2, responsavel: 'Prof. Pedro Costa', descricao: 'Esporte e cidadania', imagem: 'https://images.unsplash.com/photo-1503676260728-1c00da094a0b', local: 'Quadra' },
                { id: 6, nome: 'Oficina de Pintura', categoria: 'Cultura', status: 'Ativa', centroId: 3, responsavel: 'Prof. Roberto Lima', descricao: 'Artes plásticas', imagem: 'https://images.unsplash.com/photo-1460661419201-fd4cecdf8a8b', local: 'Ateliê' }
            ];
            agenda = JSON.parse(localStorage.getItem(STORAGE_KEYS.AGENDA)) || [
                { id: 1, dia: 'Segunda', horario: '18:00 - 20:00', atividadeId: 1, local: 'Sala Esportiva', responsavel: 'Prof. João Silva', status: 'Confirmado' },
                { id: 2, dia: 'Segunda', horario: '19:00 - 21:00', atividadeId: 3, local: 'Lab. Informática', responsavel: 'Prof. Carlos Oliveira', status: 'Confirmado' },
                { id: 3, dia: 'Quarta', horario: '16:00 - 18:00', atividadeId: 5, local: 'Quadra', responsavel: 'Prof. Pedro Costa', status: 'Confirmado' },
                { id: 4, dia: 'Quarta', horario: '19:00 - 21:00', atividadeId: 2, local: 'Sala Cultural', responsavel: 'Profa. Maria Santos', status: 'Confirmado' },
                { id: 5, dia: 'Quarta', horario: '20:00 - 21:30', atividadeId: 6, local: 'Ateliê', responsavel: 'Prof. Roberto Lima', status: 'Confirmado' },
                { id: 6, dia: 'Sexta', horario: '17:00 - 19:00', atividadeId: 3, local: 'Lab. Informática', responsavel: 'Prof. Carlos Oliveira', status: 'Confirmado' }
            ];
            galeria = JSON.parse(localStorage.getItem(STORAGE_KEYS.GALERIA)) || [
                { id: 1, atividadeId: 1, imagem: 'https://images.unsplash.com/photo-1544717305-996b815c338c', legenda: 'Karatê Comunitário' },
                { id: 2, atividadeId: 2, imagem: 'https://images.unsplash.com/photo-1523580846011-d3a5bc25702b', legenda: 'Ballet Social' },
                { id: 3, atividadeId: 3, imagem: 'https://images.unsplash.com/photo-1497633762265-9d179a990aa6', legenda: 'Inclusão Digital' },
                { id: 4, atividadeId: 5, imagem: 'https://images.unsplash.com/photo-1503676260728-1c00da094a0b', legenda: 'Escolinha de Futebol' },
                { id: 5, atividadeId: 6, imagem: 'https://images.unsplash.com/photo-1460661419201-fd4cecdf8a8b', legenda: 'Oficina de Pintura' },
                { id: 6, atividadeId: 4, imagem: 'https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b', legenda: 'Yoga para Idosos' }
            ];
            avisos = JSON.parse(localStorage.getItem(STORAGE_KEYS.AVISOS)) || [
                { id: 1, titulo: 'Reunião de planejamento', mensagem: 'Dia 20/03 às 14h na sala 1.', data: '2026-03-15', autor: 'Coordenação' },
                { id: 2, titulo: 'Inscrições abertas', mensagem: 'Novas turmas de informática.', data: '2026-03-10', autor: 'Secretaria' }
            ];
            // Atualizar contagem de atividades nos centros
            atualizarContagemAtividades();
        }

        function salvarDados() {
            localStorage.setItem(STORAGE_KEYS.CENTROS, JSON.stringify(centros));
            localStorage.setItem(STORAGE_KEYS.ATIVIDADES, JSON.stringify(atividades));
            localStorage.setItem(STORAGE_KEYS.AGENDA, JSON.stringify(agenda));
            localStorage.setItem(STORAGE_KEYS.GALERIA, JSON.stringify(galeria));
            localStorage.setItem(STORAGE_KEYS.AVISOS, JSON.stringify(avisos));
        }

        // Atualiza o campo 'atividades' nos centros baseado nas atividades ativas
        function atualizarContagemAtividades() {
            const countMap = {};
            atividades.forEach(a => {
                if (a.status === 'Ativa') {
                    countMap[a.centroId] = (countMap[a.centroId] || 0) + 1;
                }
            });
            centros.forEach(c => {
                c.atividades = countMap[c.id] || 0;
            });
        }

        // ==================== FUNÇÕES DE RENDERIZAÇÃO (COMPONENTES) ====================
        function renderStats() {
            const stats = [
                { label: 'Centros Parceiros', value: centros.length, icon: 'building', color: 'primary' },
                { label: 'Atividades Ativas', value: atividades.filter(a => a.status === 'Ativa').length, icon: 'calendar-check', color: 'success' },
                { label: 'Participantes', value: 450, icon: 'people', color: 'warning' }, // mock
                { label: 'Eventos/Mês', value: agenda.length, icon: 'graph-up', color: 'info' }
            ];
            document.getElementById('statsContainer').innerHTML = stats.map(s => `
                <div class="col-md-3">
                    <div class="card stat-card ${s.color} shadow-sm">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start">
                                <div><div class="stat-value text-${s.color}">${s.value}</div><div class="stat-label">${s.label}</div></div>
                                <i class="bi bi-${s.icon} text-${s.color}" style="font-size: 2rem; opacity: 0.3;"></i>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderAvisos() {   // NOVO COMPONENTE
            const container = document.getElementById('avisosContainer');
            container.innerHTML = avisos.map(a => {
                const dataFormatada = new Date(a.data).toLocaleDateString('pt-BR');
                return `
                    <div class="col-md-4">
                        <div class="card notice-card shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title fw-bold">${a.titulo}</h5>
                                <p class="card-text">${a.mensagem}</p>
                                <div class="notice-date">
                                    <i class="bi bi-calendar3"></i> ${dataFormatada}
                                    <i class="bi bi-person ms-3"></i> ${a.autor}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderCentros() {
            const tbody = document.getElementById('centrosTable');
            tbody.innerHTML = centros.map(c => `
                <tr>
                    <td>#${c.id.toString().padStart(3,'0')}</td>
                    <td><strong>${c.nome}</strong></td>
                    <td>${c.cidade}</td>
                    <td>${c.telefone}</td>
                    <td>${c.email}</td>
                    <td><span class="badge bg-primary">${c.atividades}</span></td>
                    <td class="text-center action-buttons">
                        <button class="btn btn-sm btn-outline-primary" onclick="visualizarCentro(${c.id})"><i class="bi bi-eye"></i></button>
                        <button class="btn btn-sm btn-outline-success" onclick="editarCentro(${c.id})"><i class="bi bi-pencil"></i></button>
                        <button class="btn btn-sm btn-outline-danger" onclick="excluirCentro(${c.id})"><i class="bi bi-trash"></i></button>
                    </td>
                </tr>
            `).join('');
        }

        function renderAtividades(filtroCategoria = '', filtroCentro = '', filtroStatus = '') {
            const grid = document.getElementById('atividadesGrid');
            let filtered = atividades.filter(a => 
                (filtroCategoria ? a.categoria === filtroCategoria : true) &&
                (filtroCentro ? a.centroId == filtroCentro : true) &&
                (filtroStatus ? a.status === filtroStatus : true)
            );
            grid.innerHTML = filtered.map(a => {
                const centro = centros.find(c => c.id === a.centroId) || { nome: 'Desconhecido' };
                const badgeClass = {
                    'Esporte': 'badge-esporte',
                    'Cultura': 'badge-cultura',
                    'Educação': 'badge-educacao',
                    'Saúde': 'badge-saude'
                }[a.categoria] || 'badge-secondary';
                const statusClass = a.status === 'Ativa' ? 'bg-success' : (a.status === 'Planejamento' ? 'bg-warning text-dark' : 'bg-secondary');
                return `
                    <div class="col-md-6 col-lg-4">
                        <div class="card activity-card shadow-sm">
                            <img src="${a.imagem}" alt="${a.nome}" loading="lazy">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start mb-3">
                                    <span class="badge badge-category ${badgeClass}">${a.categoria}</span>
                                    <span class="badge ${statusClass}">${a.status}</span>
                                </div>
                                <h5 class="card-title fw-bold">${a.nome}</h5>
                                <p class="card-text text-muted">${a.descricao}</p>
                                <div class="d-flex align-items-center text-muted small mb-2"><i class="bi bi-building me-2"></i><span>${centro.nome}</span></div>
                                <div class="d-flex align-items-center text-muted small mb-3"><i class="bi bi-person me-2"></i><span>${a.responsavel}</span></div>
                                <div class="d-flex gap-2">
                                    <button class="btn btn-sm btn-outline-primary flex-fill" onclick="alert('Detalhes da atividade ${a.nome}')">Ver Detalhes</button>
                                    <button class="btn btn-sm btn-outline-secondary flex-fill" onclick="alert('Agenda da atividade ${a.nome}')">Agenda</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            // Preenche selects de filtro
            popularFiltros();
        }

        function popularFiltros() {
            const selectCentro = document.getElementById('filtroCentro');
            if (selectCentro.options.length <= 1) {
                centros.forEach(c => selectCentro.add(new Option(c.nome, c.id)));
            }
            const selectAtividade = document.getElementById('selectAtividade');
            if (selectAtividade) {
                selectAtividade.innerHTML = '<option value="">Selecione</option>';
                atividades.forEach(a => selectAtividade.add(new Option(a.nome, a.id)));
            }
        }

        function renderAgenda() {
            const tbody = document.getElementById('agendaTable');
            tbody.innerHTML = agenda.map(item => {
                const atividade = atividades.find(a => a.id === item.atividadeId) || { nome: 'Desconhecida' };
                const centro = centros.find(c => c.id === (atividade.centroId)) || { nome: 'Desconhecido' };
                return `<tr>
                    <td><strong>${item.dia}</strong></td>
                    <td>${item.horario}</td>
                    <td>${atividade.nome}</td>
                    <td>${centro.nome}</td>
                    <td>${item.local}</td>
                    <td>${item.responsavel}</td>
                    <td class="text-center"><span class="badge bg-success">${item.status}</span></td>
                </tr>`;
            }).join('');
            // Calendário visual simplificado
            const dias = ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb', 'Dom'];
            const hoje = new Date().getDate();
            const primeiroDia = new Date(new Date().getFullYear(), new Date().getMonth(), 1).getDay(); // 0=domingo
            const diasNoMes = new Date(new Date().getFullYear(), new Date().getMonth() + 1, 0).getDate();
            let calendario = '';
            for (let i = 0; i < 7; i++) {
                const diaNum = (i + 1) <= (7 - primeiroDia) ? i + 1 : (i + 1) - (7 - primeiroDia);
                const temEvento = agenda.some(a => a.dia === dias[i]); // simplificado
                calendario += `<div class="calendar-day ${temEvento ? 'has-event' : ''}">
                    <div class="day-name">${dias[i]}</div>
                    <div class="day-number">${diaNum}</div>
                    ${temEvento ? '<div><span class="event-dot"></span></div>' : ''}
                </div>`;
            }
            document.getElementById('calendarioSemanas').innerHTML = calendario;
        }

        function renderGaleria() {
            const grid = document.getElementById('galeriaGrid');
            grid.innerHTML = galeria.map(g => {
                const atividade = atividades.find(a => a.id === g.atividadeId) || { nome: '' };
                return `<div class="gallery-item">
                    <img src="${g.imagem}" alt="${atividade.nome}" loading="lazy">
                    <div class="gallery-overlay"><h6 class="mb-1">${g.legenda}</h6><small>${atividade.nome}</small></div>
                </div>`;
            }).join('');
        }

        function updateCharts() {
            // Destroi gráficos anteriores se existirem
            Chart.helpers.each(Chart.instances, instance => instance.destroy());
            
            const catCount = { Esporte:0, Cultura:0, Educação:0, Saúde:0 };
            atividades.forEach(a => catCount[a.categoria]++);
            const ctxCat = document.getElementById('categoriesChart').getContext('2d');
            new Chart(ctxCat, {
                type: 'bar',
                data: {
                    labels: Object.keys(catCount),
                    datasets: [{
                        label: 'Atividades',
                        data: Object.values(catCount),
                        backgroundColor: ['#0d6efd','#7b1fa2','#388e3c','#f57c00'],
                        borderRadius: 8
                    }]
                },
                options: { responsive: true, maintainAspectRatio: true, plugins: { legend: { display: false } } }
            });
            
            const statusCount = { Ativa:0, Planejamento:0, Concluída:0 };
            atividades.forEach(a => statusCount[a.status]++);
            const ctxDist = document.getElementById('distributionChart').getContext('2d');
            new Chart(ctxDist, {
                type: 'doughnut',
                data: {
                    labels: ['Ativas', 'Planejamento', 'Concluídas'],
                    datasets: [{
                        data: [statusCount.Ativa, statusCount.Planejamento, statusCount.Concluída],
                        backgroundColor: ['#198754','#ffc107','#6c757d']
                    }]
                },
                options: { plugins: { legend: { position: 'bottom' } } }
            });
        }

        // ==================== FUNÇÕES ADMIN (CRUD) ====================
        function renderAdminCentros() {
            const tbody = document.getElementById('adminCentrosTable');
            tbody.innerHTML = centros.map(c => `
                <tr>
                    <td>${c.id}</td>
                    <td>${c.nome}</td>
                    <td>${c.cidade}</td>
                    <td>${c.telefone}</td>
                    <td>${c.email}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="editarCentro(${c.id})"><i class="bi bi-pencil"></i></button>
                        <button class="btn btn-sm btn-outline-danger" onclick="excluirCentro(${c.id})"><i class="bi bi-trash"></i></button>
                    </td>
                </tr>
            `).join('');
        }

        function renderAdminAtividades() {
            const tbody = document.getElementById('adminAtividadesTable');
            tbody.innerHTML = atividades.map(a => {
                const centro = centros.find(c => c.id === a.centroId) || { nome: 'Desconhecido' };
                return `<tr>
                    <td>${a.id}</td>
                    <td>${a.nome}</td>
                    <td>${a.categoria}</td>
                    <td>${centro.nome}</td>
                    <td>${a.responsavel}</td>
                    <td><span class="badge ${a.status === 'Ativa' ? 'bg-success' : a.status === 'Planejamento' ? 'bg-warning' : 'bg-secondary'}">${a.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="editarAtividade(${a.id})"><i class="bi bi-pencil"></i></button>
                        <button class="btn btn-sm btn-outline-danger" onclick="excluirAtividade(${a.id})"><i class="bi bi-trash"></i></button>
                    </td>
                </tr>`;
            }).join('');
        }

        function renderAdminAgenda() {
            const tbody = document.getElementById('adminAgendaTable');
            tbody.innerHTML = agenda.map(item => {
                const atividade = atividades.find(a => a.id === item.atividadeId) || { nome: 'Desconhecida' };
                return `<tr>
                    <td>${item.id}</td>
                    <td>${item.dia}</td>
                    <td>${item.horario}</td>
                    <td>${atividade.nome}</td>
                    <td>${item.local}</td>
                    <td>${item.responsavel}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="editarAgenda(${item.id})"><i class="bi bi-pencil"></i></button>
                        <button class="btn btn-sm btn-outline-danger" onclick="excluirAgenda(${item.id})"><i class="bi bi-trash"></i></button>
                    </td>
                </tr>`;
            }).join('');
        }

        function renderAdminGaleria() {
            const tbody = document.getElementById('adminGaleriaTable');
            tbody.innerHTML = galeria.map(g => {
                const atividade = atividades.find(a => a.id === g.atividadeId) || { nome: 'Desconhecida' };
                return `<tr>
                    <td>${g.id}</td>
                    <td><img src="${g.imagem}" alt="${g.legenda}" style="width:50px; height:50px; object-fit:cover;"></td>
                    <td>${atividade.nome}</td>
                    <td>${g.legenda}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="editarGaleria(${g.id})"><i class="bi bi-pencil"></i></button>
                        <button class="btn btn-sm btn-outline-danger" onclick="excluirGaleria(${g.id})"><i class="bi bi-trash"></i></button>
                    </td>
                </tr>`;
            }).join('');
        }

        // NOVO: Admin Mural
        function renderAdminAvisos() {
            const tbody = document.getElementById('adminAvisosTable');
            tbody.innerHTML = avisos.map(a => `
                <tr>
                    <td>${a.id}</td>
                    <td>${a.titulo}</td>
                    <td>${a.mensagem.substring(0, 30)}${a.mensagem.length > 30 ? '...' : ''}</td>
                    <td>${new Date(a.data).toLocaleDateString('pt-BR')}</td>
                    <td>${a.autor}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="editarAviso(${a.id})"><i class="bi bi-pencil"></i></button>
                        <button class="btn btn-sm btn-outline-danger" onclick="excluirAviso(${a.id})"><i class="bi bi-trash"></i></button>
                    </td>
                </tr>
            `).join('');
        }

        // Funções para abrir modais de criação (admin)
        function abrirModalCentroAdmin() {
            document.getElementById('modalCentroTitle').innerText = 'Novo Centro';
            document.getElementById('centroId').value = '';
            document.getElementById('formCentro').reset();
            new bootstrap.Modal(document.getElementById('modalCentro')).show();
        }

        function abrirModalAtividadeAdmin() {
            document.getElementById('modalAtividadeTitle').innerText = 'Nova Atividade';
            document.getElementById('atividadeId').value = '';
            document.getElementById('formAtividade').reset();
            preencherSelectCentros('atvCentro');
            new bootstrap.Modal(document.getElementById('modalAtividade')).show();
        }

        function abrirModalAgendaAdmin() {
            document.getElementById('modalAgendaTitle').innerText = 'Novo Evento';
            document.getElementById('agendaId').value = '';
            document.getElementById('formAgenda').reset();
            preencherSelectAtividades('agAtividade');
            new bootstrap.Modal(document.getElementById('modalAgenda')).show();
        }

        function abrirModalGaleriaAdmin() {
            document.getElementById('modalGaleriaTitle').innerText = 'Adicionar Imagem';
            document.getElementById('galeriaId').value = '';
            document.getElementById('formGaleria').reset();
            preencherSelectAtividades('galAtividade');
            new bootstrap.Modal(document.getElementById('modalGaleria')).show();
        }

        function abrirModalAvisoAdmin() {   // NOVO
            document.getElementById('modalAvisoTitle').innerText = 'Novo Aviso';
            document.getElementById('avisoId').value = '';
            document.getElementById('formAviso').reset();
            // Preenche data atual como padrão
            const hoje = new Date().toISOString().split('T')[0];
            document.getElementById('avisoData').value = hoje;
            new bootstrap.Modal(document.getElementById('modalAviso')).show();
        }

        // Preencher selects
        function preencherSelectCentros(elementId) {
            const select = document.getElementById(elementId);
            select.innerHTML = '';
            centros.forEach(c => select.add(new Option(c.nome, c.id)));
        }

        function preencherSelectAtividades(elementId) {
            const select = document.getElementById(elementId);
            select.innerHTML = '';
            atividades.forEach(a => select.add(new Option(a.nome, a.id)));
        }

        // CRUD Centro
        function salvarCentro() {
            const id = document.getElementById('centroId').value;
            const nome = document.getElementById('centroNome').value;
            const cidade = document.getElementById('centroCidade').value;
            const telefone = document.getElementById('centroTelefone').value;
            const email = document.getElementById('centroEmail').value;
            if (!nome || !cidade || !telefone || !email) {
                alert('Preencha todos os campos');
                return;
            }
            if (id) {
                const centro = centros.find(c => c.id == id);
                if (centro) {
                    centro.nome = nome;
                    centro.cidade = cidade;
                    centro.telefone = telefone;
                    centro.email = email;
                }
            } else {
                const novoId = centros.length ? Math.max(...centros.map(c => c.id)) + 1 : 1;
                centros.push({ id: novoId, nome, cidade, telefone, email, atividades: 0 });
            }
            salvarDados();
            atualizarTudo();
            bootstrap.Modal.getInstance(document.getElementById('modalCentro')).hide();
        }

        function editarCentro(id) {
            const centro = centros.find(c => c.id === id);
            if (!centro) return;
            document.getElementById('modalCentroTitle').innerText = 'Editar Centro';
            document.getElementById('centroId').value = centro.id;
            document.getElementById('centroNome').value = centro.nome;
            document.getElementById('centroCidade').value = centro.cidade;
            document.getElementById('centroTelefone').value = centro.telefone;
            document.getElementById('centroEmail').value = centro.email;
            new bootstrap.Modal(document.getElementById('modalCentro')).show();
        }

        function excluirCentro(id) {
            if (confirm('Tem certeza que deseja excluir este centro? As atividades vinculadas serão perdidas.')) {
                centros = centros.filter(c => c.id !== id);
                atividades = atividades.filter(a => a.centroId !== id);
                agenda = agenda.filter(item => {
                    const atv = atividades.find(a => a.id === item.atividadeId);
                    return atv && atv.centroId !== id;
                });
                galeria = galeria.filter(g => {
                    const atv = atividades.find(a => a.id === g.atividadeId);
                    return atv && atv.centroId !== id;
                });
                salvarDados();
                atualizarTudo();
            }
        }

        // CRUD Atividade
        function salvarAtividade() {
            const id = document.getElementById('atividadeId').value;
            const nome = document.getElementById('atvNome').value;
            const categoria = document.getElementById('atvCategoria').value;
            const centroId = parseInt(document.getElementById('atvCentro').value);
            const responsavel = document.getElementById('atvResponsavel').value;
            const status = document.getElementById('atvStatus').value;
            const descricao = document.getElementById('atvDescricao').value;
            const imagem = document.getElementById('atvImagem').value;
            const local = document.getElementById('atvLocal').value;
            if (!nome || !centroId || !responsavel) {
                alert('Preencha os campos obrigatórios');
                return;
            }
            if (id) {
                const atv = atividades.find(a => a.id == id);
                if (atv) {
                    atv.nome = nome;
                    atv.categoria = categoria;
                    atv.centroId = centroId;
                    atv.responsavel = responsavel;
                    atv.status = status;
                    atv.descricao = descricao;
                    atv.imagem = imagem;
                    atv.local = local;
                }
            } else {
                const novoId = atividades.length ? Math.max(...atividades.map(a => a.id)) + 1 : 1;
                atividades.push({ id: novoId, nome, categoria, centroId, responsavel, status, descricao, imagem, local });
            }
            atualizarContagemAtividades();
            salvarDados();
            atualizarTudo();
            bootstrap.Modal.getInstance(document.getElementById('modalAtividade')).hide();
        }

        function editarAtividade(id) {
            const atv = atividades.find(a => a.id === id);
            if (!atv) return;
            document.getElementById('modalAtividadeTitle').innerText = 'Editar Atividade';
            document.getElementById('atividadeId').value = atv.id;
            document.getElementById('atvNome').value = atv.nome;
            document.getElementById('atvCategoria').value = atv.categoria;
            preencherSelectCentros('atvCentro');
            document.getElementById('atvCentro').value = atv.centroId;
            document.getElementById('atvResponsavel').value = atv.responsavel;
            document.getElementById('atvStatus').value = atv.status;
            document.getElementById('atvDescricao').value = atv.descricao;
            document.getElementById('atvImagem').value = atv.imagem;
            document.getElementById('atvLocal').value = atv.local;
            new bootstrap.Modal(document.getElementById('modalAtividade')).show();
        }

        function excluirAtividade(id) {
            if (confirm('Excluir esta atividade também removerá eventos na agenda e imagens da galeria vinculados?')) {
                atividades = atividades.filter(a => a.id !== id);
                agenda = agenda.filter(item => item.atividadeId !== id);
                galeria = galeria.filter(g => g.atividadeId !== id);
                atualizarContagemAtividades();
                salvarDados();
                atualizarTudo();
            }
        }

        // CRUD Agenda
        function salvarAgenda() {
            const id = document.getElementById('agendaId').value;
            const dia = document.getElementById('agDia').value;
            const horario = document.getElementById('agHorario').value;
            const atividadeId = parseInt(document.getElementById('agAtividade').value);
            const local = document.getElementById('agLocal').value;
            const responsavel = document.getElementById('agResponsavel').value;
            const status = document.getElementById('agStatus').value;
            if (!dia || !horario || !atividadeId || !local || !responsavel) {
                alert('Preencha todos os campos');
                return;
            }
            if (id) {
                const ev = agenda.find(e => e.id == id);
                if (ev) {
                    ev.dia = dia;
                    ev.horario = horario;
                    ev.atividadeId = atividadeId;
                    ev.local = local;
                    ev.responsavel = responsavel;
                    ev.status = status;
                }
            } else {
                const novoId = agenda.length ? Math.max(...agenda.map(e => e.id)) + 1 : 1;
                agenda.push({ id: novoId, dia, horario, atividadeId, local, responsavel, status });
            }
            salvarDados();
            atualizarTudo();
            bootstrap.Modal.getInstance(document.getElementById('modalAgenda')).hide();
        }

        function editarAgenda(id) {
            const ev = agenda.find(e => e.id === id);
            if (!ev) return;
            document.getElementById('modalAgendaTitle').innerText = 'Editar Evento';
            document.getElementById('agendaId').value = ev.id;
            document.getElementById('agDia').value = ev.dia;
            document.getElementById('agHorario').value = ev.horario;
            preencherSelectAtividades('agAtividade');
            document.getElementById('agAtividade').value = ev.atividadeId;
            document.getElementById('agLocal').value = ev.local;
            document.getElementById('agResponsavel').value = ev.responsavel;
            document.getElementById('agStatus').value = ev.status;
            new bootstrap.Modal(document.getElementById('modalAgenda')).show();
        }

        function excluirAgenda(id) {
            if (confirm('Excluir este evento?')) {
                agenda = agenda.filter(e => e.id !== id);
                salvarDados();
                atualizarTudo();
            }
        }

        // CRUD Galeria
        function salvarGaleria() {
            const id = document.getElementById('galeriaId').value;
            const atividadeId = parseInt(document.getElementById('galAtividade').value);
            const imagem = document.getElementById('galImagem').value;
            const legenda = document.getElementById('galLegenda').value;
            if (!atividadeId || !imagem || !legenda) {
                alert('Preencha todos os campos');
                return;
            }
            if (id) {
                const g = galeria.find(g => g.id == id);
                if (g) {
                    g.atividadeId = atividadeId;
                    g.imagem = imagem;
                    g.legenda = legenda;
                }
            } else {
                const novoId = galeria.length ? Math.max(...galeria.map(g => g.id)) + 1 : 1;
                galeria.push({ id: novoId, atividadeId, imagem, legenda });
            }
            salvarDados();
            atualizarTudo();
            bootstrap.Modal.getInstance(document.getElementById('modalGaleria')).hide();
        }

        function editarGaleria(id) {
            const g = galeria.find(g => g.id === id);
            if (!g) return;
            document.getElementById('modalGaleriaTitle').innerText = 'Editar Imagem';
            document.getElementById('galeriaId').value = g.id;
            preencherSelectAtividades('galAtividade');
            document.getElementById('galAtividade').value = g.atividadeId;
            document.getElementById('galImagem').value = g.imagem;
            document.getElementById('galLegenda').value = g.legenda;
            new bootstrap.Modal(document.getElementById('modalGaleria')).show();
        }

        function excluirGaleria(id) {
            if (confirm('Excluir esta imagem?')) {
                galeria = galeria.filter(g => g.id !== id);
                salvarDados();
                atualizarTudo();
            }
        }

        // NOVO: CRUD Aviso
        function salvarAviso() {
            const id = document.getElementById('avisoId').value;
            const titulo = document.getElementById('avisoTitulo').value;
            const mensagem = document.getElementById('avisoMensagem').value;
            const data = document.getElementById('avisoData').value;
            const autor = document.getElementById('avisoAutor').value;
            if (!titulo || !mensagem || !data || !autor) {
                alert('Preencha todos os campos');
                return;
            }
            if (id) {
                const aviso = avisos.find(a => a.id == id);
                if (aviso) {
                    aviso.titulo = titulo;
                    aviso.mensagem = mensagem;
                    aviso.data = data;
                    aviso.autor = autor;
                }
            } else {
                const novoId = avisos.length ? Math.max(...avisos.map(a => a.id)) + 1 : 1;
                avisos.push({ id: novoId, titulo, mensagem, data, autor });
            }
            salvarDados();
            atualizarTudo();
            bootstrap.Modal.getInstance(document.getElementById('modalAviso')).hide();
        }

        function editarAviso(id) {
            const aviso = avisos.find(a => a.id === id);
            if (!aviso) return;
            document.getElementById('modalAvisoTitle').innerText = 'Editar Aviso';
            document.getElementById('avisoId').value = aviso.id;
            document.getElementById('avisoTitulo').value = aviso.titulo;
            document.getElementById('avisoMensagem').value = aviso.mensagem;
            document.getElementById('avisoData').value = aviso.data;
            document.getElementById('avisoAutor').value = aviso.autor;
            new bootstrap.Modal(document.getElementById('modalAviso')).show();
        }

        function excluirAviso(id) {
            if (confirm('Excluir este aviso?')) {
                avisos = avisos.filter(a => a.id !== id);
                salvarDados();
                atualizarTudo();
            }
        }

        // Visualização (apenas alert)
        function visualizarCentro(id) {
            const centro = centros.find(c => c.id === id);
            alert(`Centro: ${centro.nome}\nCidade: ${centro.cidade}\nTelefone: ${centro.telefone}\nEmail: ${centro.email}`);
        }

        // ==================== EXPORTAR/IMPORTAR JSON ====================
        function exportarJSON() {
            const data = {
                centros,
                atividades,
                agenda,
                galeria,
                avisos   // NOVO
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'communityhub_dados.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        function importarJSON() {
            const fileInput = document.getElementById('importFile');
            if (!fileInput.files.length) {
                alert('Selecione um arquivo JSON');
                return;
            }
            const file = fileInput.files[0];
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.centros) centros = data.centros;
                    if (data.atividades) atividades = data.atividades;
                    if (data.agenda) agenda = data.agenda;
                    if (data.galeria) galeria = data.galeria;
                    if (data.avisos) avisos = data.avisos;   // NOVO
                    salvarDados();
                    atualizarTudo();
                    alert('Dados importados com sucesso!');
                } catch (error) {
                    alert('Erro ao importar arquivo: ' + error);
                }
            };
            reader.readAsText(file);
        }

        // ==================== ATUALIZAÇÃO GERAL ====================
        function atualizarTudo() {
            renderStats();
            renderAvisos();      // NOVO
            renderCentros();
            renderAtividades(
                document.getElementById('filtroCategoria').value,
                document.getElementById('filtroCentro').value,
                document.getElementById('filtroStatus').value
            );
            renderAgenda();
            renderGaleria();
            updateCharts();
            // Atualiza tabelas admin se o modal estiver aberto
            if (document.getElementById('modalAdmin').classList.contains('show')) {
                renderAdminCentros();
                renderAdminAtividades();
                renderAdminAgenda();
                renderAdminGaleria();
                renderAdminAvisos();   // NOVO
            }
        }

        // ==================== INICIALIZAÇÃO ====================
        document.addEventListener('DOMContentLoaded', function() {
            carregarDados();
            atualizarTudo();
            
            // Filtros
            document.getElementById('filtroCategoria').addEventListener('change', function(e) {
                renderAtividades(e.target.value, document.getElementById('filtroCentro').value, document.getElementById('filtroStatus').value);
            });
            document.getElementById('filtroCentro').addEventListener('change', function(e) {
                renderAtividades(document.getElementById('filtroCategoria').value, e.target.value, document.getElementById('filtroStatus').value);
            });
            document.getElementById('filtroStatus').addEventListener('change', function(e) {
                renderAtividades(document.getElementById('filtroCategoria').value, document.getElementById('filtroCentro').value, e.target.value);
            });

            // Quando o modal admin for aberto, renderizar tabelas
            document.getElementById('modalAdmin').addEventListener('shown.bs.modal', function() {
                renderAdminCentros();
                renderAdminAtividades();
                renderAdminAgenda();
                renderAdminGaleria();
                renderAdminAvisos();   // NOVO
                preencherSelectAtividades('agAtividade');
                preencherSelectAtividades('galAtividade');
                preencherSelectCentros('atvCentro');
            });
        });
    </script>
</body>
</html>